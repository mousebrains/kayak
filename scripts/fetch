# /bin/bash -x
# 
# Fetch data from various providers
#
ROOT=`dirname $0` # Where am I located at
MAILTO='pat@mousebrains.com'

BINDIR=/Users/Pat/tpw/kayak/src/bin
FETCH=$BINDIR/fetch
MAILER='2>&1 | $EXEROOT/mailFilter $MAILTO'
MAILER=

# Get data from the USGS
#
# format=waterml,2.0 Water XML format version 2.0
# stateCd=or Oregon 
# stateCd=wa Washington 
# stateCd=id Idaho 
# parameterCd 00060 flow
# parameterCd 00065 gauge height
# parameterCd 00010 temperature
# siteType=ST,ST-TS Streams and tidal streams
# siteStatus=active only active sites
# modifiedSince=PT2H data updated in the previous 2 hours
#
TIMEBACK=PT12H 
USGS0="$FETCH -u USGS0:http://waterservices.usgs.gov/nwis/iv/?format=waterml,2.0&parameterCd=00060,00065,00010&siteType=ST,ST-TS&siteStatus=active&modifiedSince=${TIMEBACK}&stateCd"

$USGS0=or # Oregon
$USGS0=id # Idaho
$USGS0=wa # Washington

# NOAA gauge information, 
#
# id= CBTT ID

NOAA0="$FETCH -u NOAA0:http://www.nwrfc.noaa.gov/xml/xml.cgi?id"

$NOAA0=MYPO3 # SF Coquille Myrtle Point
$NOAA0=COQO3 # Coquille at Coquille
$NOAA0=CWMO3 # Cow Creek Below McCullough Creen near Glendale
$NOAA0=CREO3 # Crescent Creek at Crescent Lake near Crescent
$NOAA0=CRPO3 # Crooked River above Prineville Reservoir
$NOAA0=PRVO3 # Crooked River near Prineville
$NOAA0=LAPO3 # Little Deschutes River near La Pine
$NOAA0=WICO3 # Deschutes below Wickiup Resv near La Pine
$NOAA0=BENO3 # Deschutes at Benham Falls
$NOAA0=DEBO3 # Deschutes Below Bend
$NOAA0=ECDO3 # Elk Creek near Drain
$NOAA0=LGNO3 # Grande Ronde near Perry
$NOAA0=WFHO3 # West Fork Hood near Dee
$NOAA0=IMNO3 # Imnaha at Imnaha
$NOAA0=MKLO3 # McKenzie below Leeburg Dam
$NOAA0=MCZO3 # McKenzie near Walterville
$NOAA0=BEAO3 # Nestucca near Beaver
$NOAA0=OCHO3 # Ochoco Creek below Ochoco Dam near Prineville
$NOAA0=AURO3 # Pudding at Aurora
$NOAA0=RPRO3 # Rogue below Prospect

# Update calculates and levels tables using the information we just loaded in

$BINDIR/updateCalcs # Update calculations

$BINDIR/updateLevels # Update levels
